<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OSC 설정 및 신호 보내기</title>
</head>
<body>
    <div>
        <h2>OSC 주소 설정</h2>
        <input type="text" id="oscAddress" placeholder="OSC 주소 입력 (예: 127.0.0.1)" />
        <input type="text" id="oscPort1" placeholder="포트 1 입력 (예: 7000)" />
        <input type="text" id="oscPort2" placeholder="포트 2 입력 (예: 7001)" />
        <button id="saveSettingsButton">설정 저장</button>

        <h2>OSC 신호 전송</h2>
        <input type="text" id="oscMsgAddress1" placeholder="단일 신호 주소" />
        <button class="sendOscButton" data-index="1">1</button>

        <h2>반복 신호 설정</h2>
        <input type="text" id="loopMsgAddress" placeholder="반복 신호 주소" />
        <input type="text" id="loopInterval" placeholder="간격 (ms)" />
        <button id="startLoopButton">반복 시작</button>
        <button id="stopLoopButton">반복 중지</button>
    </div>

    <div>
        <h1>WebSocket 연결 상태</h1>
        <div id="connectionStatus">대기 중</div>
    </div>

    <script>
      let socket;
      let loopIntervalId = null;
      let oscAddress, oscPort1, oscPort2;

      // WebSocket 연결
      function connectWebSocket() {
          socket = new WebSocket('ws://localhost:3001');

          socket.addEventListener('open', () => {
              console.log('WebSocket 연결됨');
              updateConnectionStatus(true);
          });

          socket.addEventListener('close', () => {
              console.error('WebSocket 연결 끊김');
              updateConnectionStatus(false);
          });
      }

      function updateConnectionStatus(isConnected) {
          document.getElementById('connectionStatus').textContent = isConnected ? '연결됨' : '연결 끊김';
      }

      document.addEventListener("DOMContentLoaded", () => {
          const saveSettingsButton = document.getElementById('saveSettingsButton');
          const oscMsgAddress1Input = document.getElementById('oscMsgAddress1');

          // OSC 설정 저장
          saveSettingsButton.addEventListener('click', () => {
              oscAddress = document.getElementById('oscAddress').value;
              oscPort1 = parseInt(document.getElementById('oscPort1').value, 10);
              oscPort2 = parseInt(document.getElementById('oscPort2').value, 10);

              if (oscAddress && oscPort1 && oscPort2) {
                  console.log(`OSC 설정 저장: 주소=${oscAddress}, 포트1=${oscPort1}, 포트2=${oscPort2}`);
              } else {
                  console.error("OSC 주소와 포트를 모두 입력하세요.");
              }
          });

          // 단일 OSC 메시지 전송
          document.querySelector('.sendOscButton').addEventListener('click', () => {
              const oscMsgAddress = oscMsgAddress1Input.value;

              if (oscMsgAddress.trim() && oscAddress && oscPort1 && oscPort2) {
                  console.log(`포트 1에 OSC 메시지 전송: ${oscMsgAddress}, 주소: ${oscAddress}, 포트1: ${oscPort1}, 포트2: ${oscPort2}`);
                  socket.send(JSON.stringify({
                      address: oscMsgAddress,
                      content: null, // 여기서 특정 내용을 추가할 수 있습니다.
                      port1: oscPort1,
                      port2: oscPort2
                  }));
              } else {
                  console.error("OSC 메시지 주소와 포트를 입력하세요.");
              }
          });

          // 반복 신호 전송
          document.getElementById('startLoopButton').addEventListener('click', () => {
              const loopMsgAddress = document.getElementById('loopMsgAddress').value;
              const loopInterval = parseInt(document.getElementById('loopInterval').value, 10);

              if (loopMsgAddress && loopInterval && oscAddress && oscPort1 && oscPort2) {
                  loopIntervalId = setInterval(() => {
                      console.log(`반복 신호 전송: ${loopMsgAddress}, 간격: ${loopInterval}ms`);
                      socket.send(JSON.stringify({
                          address: loopMsgAddress,
                          content: null,
                          port1: oscPort1,
                          port2: oscPort2
                      }));
                  }, loopInterval);
              } else {
                  console.error("반복 신호 주소와 간격, OSC 설정을 입력하세요.");
              }
          });

          // 반복 신호 중지
          document.getElementById('stopLoopButton').addEventListener('click', () => {
              clearInterval(loopIntervalId);
              console.log("반복 신호 중지");
          });

          connectWebSocket(); // WebSocket 연결 시작
      });
    </script>
</body>
</html>
